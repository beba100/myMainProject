# ๐ ุฏููู ุจุณูุท: ุฅุถุงูุฉ ุงููุณุชุฎุฏููู ูุงููุดุฑููู ูุงููุฏูุฑูู

## ๐ฏ ุฌุฏูู `MasterUsers` - ุฏูุฑู ุงูุฃุณุงุณู

### ูุง ูู `MasterUsers`ุ
- **ุฌุฏูู ุงููุณุชุฎุฏููู ุงูุฑุฆูุณู** ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงููุฑูุฒูุฉ (Master DB)
- ูุญุชูู ุนูู **ูู ุงููุณุชุฎุฏููู** ูู ุงููุธุงู (ููุธูููุ ูุดุฑูููุ ูุฏูุฑูู)
- **ูุง ุชุบููุฑุงุช ูุทููุจุฉ ุนููู** - ุงูุฌุฏูู ููุฌูุฏ ููุนูู ุจุดูู ุตุญูุญ โ

### ุงูุฃุนูุฏุฉ ุงููููุฉ:
```
- Id: ุฑูู ุงููุณุชุฎุฏู (ุชููุงุฆู)
- Username: ุงุณู ุงููุณุชุฎุฏู (ููุชุณุฌูู)
- PasswordHash: ูููุฉ ุงููุฑูุฑ
- TenantId: ุงูููุฏู ุงูุงูุชุฑุงุถู ูููุณุชุฎุฏู
- IsActive: ูู ุงููุณุชุฎุฏู ูุดุทุ
```

---

## ๐ ูุธุงู ุงูุตูุงุญูุงุช - ููู ูุนููุ

### ุงูุฌุฏุงูู ุงููุณุชุฎุฏูุฉ:

1. **`MasterUsers`** โ (ููุฌูุฏ - ูุง ุชุบููุฑุงุช)
   - ุจูุงูุงุช ุงููุณุชุฎุฏู ุงูุฃุณุงุณูุฉ

2. **`Roles`** โ (ููุฌูุฏ)
   - ุงูุฃุฏูุงุฑ: Admin, Manager, Accountant, Supervisor, Staff, ReadOnly

3. **`UserRoles`** โ (ููุฌูุฏ)
   - ุฑุจุท ุงููุณุชุฎุฏู ุจุงูุฃุฏูุงุฑ (ูุณุชุฎุฏู ูุงุญุฏ ูููู ุฃู ูููู ูู ุนุฏุฉ ุฃุฏูุงุฑ)

4. **`UserTenants`** โ (ุฌุฏูุฏ - ุชู ุฅูุดุงุคู)
   - ุฑุจุท ุงููุณุชุฎุฏู ุจุงูููุงุฏู (ููุตูุงุญูุงุช)

5. **`Tenants`** โ (ููุฌูุฏ)
   - ูุงุฆูุฉ ุงูููุงุฏู

---

## ๐ ุฎุทูุงุช ุฅุถุงูุฉ ูุณุชุฎุฏู ุฌุฏูุฏ

### ุงูุฎุทูุฉ 1: ุฅุถุงูุฉ ุงููุณุชุฎุฏู ูู `MasterUsers`

```sql
-- ูุซุงู: ุฅุถุงูุฉ ููุธู ุงุณุชูุจุงู ุฌุฏูุฏ
INSERT INTO MasterUsers (Username, PasswordHash, TenantId, IsActive, CreatedAt)
VALUES ('ahmed_staff', '123456', 1, 1, GETDATE());
-- TenantId = 1 ูุนูู ุงูููุฏู ุงูุงูุชุฑุงุถู (Dammam1)
```

**ููุงุญุธุฉ:** 
- `PasswordHash` ูููู ุฃู ูููู ูุต ุนุงุฏู (ูุซู "123456") ุฃู ูุดูุฑ
- `TenantId` = ุงูููุฏู ุงูุงูุชุฑุงุถู ูููุณุชุฎุฏู

---

### ุงูุฎุทูุฉ 2: ุฅุถุงูุฉ ุงูุฏูุฑ ูู `UserRoles`

#### ุฃููุงู: ูุนุฑูุฉ RoleId ูู ุฌุฏูู Roles

```sql
-- ุนุฑุถ ุฌููุน ุงูุฃุฏูุงุฑ
SELECT Id, Code, Name FROM Roles;
```

**ุงูุฃุฏูุงุฑ ุงููุชุงุญุฉ:**
- `Admin` - ูุฏูุฑ ุงููุธุงู
- `Manager` - ูุฏูุฑ
- `Accountant` - ูุญุงุณุจ
- `Supervisor` - ูุดุฑู
- `Staff` - ููุธู ุงุณุชูุจุงู
- `ReadOnly` - ูููุฑุงุกุฉ ููุท

#### ุซุงููุงู: ุฅุถุงูุฉ ุงูุฏูุฑ ูููุณุชุฎุฏู

```sql
-- ูุซุงู: ุฅุถุงูุฉ ุฏูุฑ Staff ูููุณุชุฎุฏู
-- ุงูุชุฑุถ ุฃู UserId = 19 ู RoleId ููู Staff = 5

INSERT INTO UserRoles (UserId, RoleId)
VALUES (19, 5);  -- 5 = Staff
```

---

### ุงูุฎุทูุฉ 3: ุฅุถุงูุฉ ุงูููุงุฏู ูู `UserTenants` (ุญุณุจ ุงูุฏูุฑ)

#### ุฃ) ุฅุฐุง ูุงู **Admin / Manager / Accountant**:
```sql
-- ูุง ุญุงุฌุฉ ูุฅุถุงูุฉ ุดูุก! โ
-- ูุคูุงุก ุงููุณุชุฎุฏููู ูุฑูู ูู ุงูููุงุฏู ุชููุงุฆูุงู
```

#### ุจ) ุฅุฐุง ูุงู **Staff (ููุธู ุงุณุชูุจุงู)**:
```sql
-- ุฅุถุงูุฉ ููุฏู ูุงุญุฏ ููุท
-- ูุซุงู: ุงููุณุชุฎุฏู 19 ูู ููุฏู Riyadh3 (TenantId = 9)

INSERT INTO UserTenants (UserId, TenantId)
VALUES (19, 9);  -- 9 = Riyadh3
```

#### ุฌ) ุฅุฐุง ูุงู **Supervisor (ูุดุฑู)**:
```sql
-- ุฅุถุงูุฉ ุนุฏุฉ ููุงุฏู
-- ูุซุงู: ุงููุณุชุฎุฏู 20 ูุดุฑู ุนูู 3 ููุงุฏู

INSERT INTO UserTenants (UserId, TenantId)
VALUES 
    (20, 1),  -- Dammam1
    (20, 2),  -- Dammam2
    (20, 9);  -- Riyadh3
```

---

## ๐ฏ ุฃูุซูุฉ ุนูููุฉ ูุงููุฉ

### ูุซุงู 1: ุฅุถุงูุฉ ููุธู ุงุณุชูุจุงู (Staff)

```sql
-- 1. ุฅุถุงูุฉ ุงููุณุชุฎุฏู
INSERT INTO MasterUsers (Username, PasswordHash, TenantId, IsActive, CreatedAt)
VALUES ('sara_staff', '123456', 9, 1, GETDATE());
-- ุงุญูุธ UserId (ูุซูุงู 21)

-- 2. ุฅุถุงูุฉ ุฏูุฑ Staff
-- ุฃููุงู: ูุนุฑูุฉ RoleId ููู Staff
SELECT Id FROM Roles WHERE Code = 'Staff';  -- ูุซูุงู 5

-- ุซุงููุงู: ุฅุถุงูุฉ ุงูุฏูุฑ
INSERT INTO UserRoles (UserId, RoleId)
VALUES (21, 5);  -- 21 = UserId, 5 = Staff

-- 3. ุฅุถุงูุฉ ููุฏู ูุงุญุฏ ููุท (Riyadh3)
INSERT INTO UserTenants (UserId, TenantId)
VALUES (21, 9);  -- 9 = Riyadh3
```

**ุงููุชูุฌุฉ:** ุณุงุฑุฉ ุชุฑู ููุฏู ูุงุญุฏ ููุท (Riyadh3) โ

---

### ูุซุงู 2: ุฅุถุงูุฉ ูุดุฑู (Supervisor)

```sql
-- 1. ุฅุถุงูุฉ ุงููุณุชุฎุฏู
INSERT INTO MasterUsers (Username, PasswordHash, TenantId, IsActive, CreatedAt)
VALUES ('mohamed_supervisor', '123456', 1, 1, GETDATE());
-- ุงุญูุธ UserId (ูุซูุงู 22)

-- 2. ุฅุถุงูุฉ ุฏูุฑ Supervisor
SELECT Id FROM Roles WHERE Code = 'Supervisor';  -- ูุซูุงู 4

INSERT INTO UserRoles (UserId, RoleId)
VALUES (22, 4);  -- 22 = UserId, 4 = Supervisor

-- 3. ุฅุถุงูุฉ ุนุฏุฉ ููุงุฏู
INSERT INTO UserTenants (UserId, TenantId)
VALUES 
    (22, 1),  -- Dammam1
    (22, 2),  -- Dammam2
    (22, 9);  -- Riyadh3
```

**ุงููุชูุฌุฉ:** ูุญูุฏ ูุฑู 3 ููุงุฏู โ

---

### ูุซุงู 3: ุฅุถุงูุฉ ูุฏูุฑ (Admin)

```sql
-- 1. ุฅุถุงูุฉ ุงููุณุชุฎุฏู
INSERT INTO MasterUsers (Username, PasswordHash, TenantId, IsActive, CreatedAt)
VALUES ('ali_admin', '123456', 1, 1, GETDATE());
-- ุงุญูุธ UserId (ูุซูุงู 23)

-- 2. ุฅุถุงูุฉ ุฏูุฑ Admin
SELECT Id FROM Roles WHERE Code = 'Admin';  -- ูุซูุงู 1

INSERT INTO UserRoles (UserId, RoleId)
VALUES (23, 1);  -- 23 = UserId, 1 = Admin

-- 3. ูุง ุญุงุฌุฉ ูุฅุถุงูุฉ ุดูุก ูู UserTenants! โ
-- Admin ูุฑู ูู ุงูููุงุฏู ุชููุงุฆูุงู
```

**ุงููุชูุฌุฉ:** ุนูู ูุฑู ูู ุงูููุงุฏู (48 ููุฏู) โ

---

## ๐ ุฌุฏูู ููุฎุต ุงูุตูุงุญูุงุช

| ุงูุฏูุฑ           | ุฅุถุงูุฉ ูู UserRoles | ุฅุถุงูุฉ ูู UserTenants | ุงููุชูุฌุฉ                    |
| --------------- | ------------------ | -------------------- | -------------------------- |
| **Admin**       | โ ูุนู             | โ ูุง                | ูู ุงูููุงุฏู (48 ููุฏู)       |
| **Manager**     | โ ูุนู             | โ ูุง                | ูู ุงูููุงุฏู (48 ููุฏู)       |
| **Accountant**  | โ ูุนู             | โ ูุง                | ูู ุงูููุงุฏู (48 ููุฏู)       |
| **Supervisor**  | โ ูุนู             | โ ูุนู (ุนุฏุฉ ููุงุฏู)   | ุงูููุงุฏู ุงููุญุฏุฏุฉ ููุท        |
| **Staff**       | โ ูุนู             | โ ูุนู (ููุฏู ูุงุญุฏ)   | ููุฏู ูุงุญุฏ ููุท              |
| **ReadOnly**    | โ ูุนู             | โ ูุนู               | ุงูููุงุฏู ุงููุญุฏุฏุฉ ููุท        |

---

## ๐ ุงุณุชุนูุงูุงุช ูููุฏุฉ

### ุนุฑุถ ูุนูููุงุช ูุณุชุฎุฏู ูุน ุฃุฏูุงุฑู ูููุงุฏูู

```sql
-- ุนุฑุถ ูุนูููุงุช ุงููุณุชุฎุฏู
SELECT 
    u.Id AS UserId,
    u.Username,
    u.TenantId AS DefaultTenantId,
    t.Code AS DefaultTenantCode,
    t.Name AS DefaultTenantName,
    u.IsActive
FROM MasterUsers u
LEFT JOIN Tenants t ON u.TenantId = t.Id
WHERE u.Username = 'sara_staff';
```

### ุนุฑุถ ุฃุฏูุงุฑ ุงููุณุชุฎุฏู

```sql
-- ุนุฑุถ ุฃุฏูุงุฑ ูุณุชุฎุฏู ูุนูู
SELECT 
    u.Username,
    r.Code AS RoleCode,
    r.Name AS RoleName
FROM MasterUsers u
INNER JOIN UserRoles ur ON u.Id = ur.UserId
INNER JOIN Roles r ON ur.RoleId = r.Id
WHERE u.Username = 'sara_staff';
```

### ุนุฑุถ ููุงุฏู ุงููุณุชุฎุฏู

```sql
-- ุนุฑุถ ุงูููุงุฏู ุงูุฎุงุตุฉ ุจูุณุชุฎุฏู ูุนูู
SELECT 
    u.Username,
    t.Code AS HotelCode,
    t.Name AS HotelName
FROM MasterUsers u
INNER JOIN UserTenants ut ON u.Id = ut.UserId
INNER JOIN Tenants t ON ut.TenantId = t.Id
WHERE u.Username = 'mohamed_supervisor';
```

---

## โ๏ธ ููุงุญุธุงุช ูููุฉ

1. **`MasterUsers.TenantId`** = ุงูููุฏู ุงูุงูุชุฑุงุถู (ูุณุชุฎุฏู ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู)
2. **`UserTenants`** = ุงูููุงุฏู ุงูุชู ูููู ูููุณุชุฎุฏู ุงููุตูู ุฅูููุง (ููุตูุงุญูุงุช)
3. **Admin/Manager/Accountant** ูุง ูุญุชุงุฌูู `UserTenants` - ูุฑูู ูู ุงูููุงุฏู ุชููุงุฆูุงู
4. **Staff** ูุฌุจ ุฃู ูููู ูุฏููู **ููุฏู ูุงุญุฏ ููุท** ูู `UserTenants`
5. **Supervisor** ูููู ุฃู ูููู ูุฏููู **ุนุฏุฉ ููุงุฏู** ูู `UserTenants`

---

## โ ุงูุฎูุงุตุฉ

### ุฌุฏูู `MasterUsers`:
- โ **ูุง ุชุบููุฑุงุช ูุทููุจุฉ** - ุงูุฌุฏูู ููุฌูุฏ ููุนูู ุจุดูู ุตุญูุญ
- โ ูุณุชุฎุฏู ูุฅุถุงูุฉ ุงููุณุชุฎุฏููู ุงูุฌุฏุฏ
- โ ูุญุชูู ุนูู ุจูุงูุงุช ุงููุณุชุฎุฏู ุงูุฃุณุงุณูุฉ

### ุฎุทูุงุช ุฅุถุงูุฉ ูุณุชุฎุฏู:
1. โ ุฅุถุงูุฉ ูู `MasterUsers`
2. โ ุฅุถุงูุฉ ุงูุฏูุฑ ูู `UserRoles`
3. โ ุฅุถุงูุฉ ุงูููุงุฏู ูู `UserTenants` (ุญุณุจ ุงูุฏูุฑ)

---

## ๐ ุฌุงูุฒ ููุงุณุชุฎุฏุงู!

ุงูุขู ููููู ุฅุถุงูุฉ ุฃู ูุณุชุฎุฏู ุจุณูููุฉ ุจุงุณุชุฎุฏุงู ุงูุฃูุซูุฉ ุฃุนูุงู! ๐

